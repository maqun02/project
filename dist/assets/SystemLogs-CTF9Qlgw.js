import{r as i,p as T,o as G,E as H,a as o,b as u,c as _,e as a,w as n,d as v,F as C,y as Y,q as k,u as M,A as J,g as r,B as K,v as m,t as W}from"./index-BxO9RYUF.js";import{h as X,_ as Z}from"./_plugin-vue_export-helper-xacGa6pw.js";function $(){return X.get("/logs/")}const ee={class:"system-logs"},te={class:"card-header"},ae={class:"header-actions"},le={class:"filter-container"},ne={key:0,class:"loading-container"},se={key:1,class:"empty-container"},oe={key:2,class:"logs-table"},ue={class:"pagination-container"},re={__name:"SystemLogs",setup(ce){const h=i(!1),p=i([]),w=i(0),f=i(1),B=i(20),c=i([]),s=i({user:"",action:"",status:""}),E=[{text:"今天",value:()=>[new Date,new Date]},{text:"昨天",value:()=>{const t=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24),t.setTime(t.getTime()-3600*1e3*24),[e,t]}},{text:"最近一周",value:()=>{const t=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*7),[e,t]}},{text:"最近一个月",value:()=>{const t=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*30),[e,t]}}],L=T(()=>{const t={};return p.value.forEach(e=>{e.user&&!t[e.user.id]&&(t[e.user.id]=e.user)}),Object.values(t)}),N=T(()=>{const t={};return p.value.forEach(e=>{e.action&&!t[e.action]&&(t[e.action]={value:e.action,display:e.action_display})}),Object.values(t)});function U(t){if(!t)return"";const e=new Date(t);return new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(e)}function z(){c.value=[],s.value={user:"",action:"",status:""},f.value=1,g()}function F(t){f.value=t,g()}function I(){const t={page:f.value};return c.value&&c.value.length===2&&(t.start_date=c.value[0],t.end_date=c.value[1]),s.value.user&&(t.user_id=s.value.user),s.value.action&&(t.action=s.value.action),s.value.status&&(t.status=s.value.status),t}async function g(){h.value=!0;try{const t=I(),e=await $(t);p.value=e.results||[],w.value=e.count||0}catch(t){console.error("获取日志列表失败:",t),H.error("获取日志列表失败")}finally{h.value=!1}}return G(()=>{g()}),(t,e)=>{const S=o("el-date-picker"),b=o("el-option"),D=o("el-select"),y=o("el-form-item"),V=o("el-icon"),x=o("el-button"),q=o("el-form"),P=o("el-skeleton"),j=o("el-empty"),d=o("el-table-column"),A=o("el-tag"),O=o("el-table"),Q=o("el-pagination"),R=o("el-card");return u(),_("div",ee,[a(R,{class:"logs-card"},{header:n(()=>[v("div",te,[e[4]||(e[4]=v("h2",null,"系统日志",-1)),v("div",ae,[a(S,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=l=>c.value=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",shortcuts:E},null,8,["modelValue"])])])]),default:n(()=>[v("div",le,[a(q,{inline:!0,model:s.value,class:"filter-form"},{default:n(()=>[a(y,{label:"用户"},{default:n(()=>[a(D,{modelValue:s.value.user,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.user=l),placeholder:"选择用户",clearable:"",filterable:""},{default:n(()=>[(u(!0),_(C,null,Y(L.value,l=>(u(),k(b,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(y,{label:"操作类型"},{default:n(()=>[a(D,{modelValue:s.value.action,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.action=l),placeholder:"选择操作类型",clearable:""},{default:n(()=>[(u(!0),_(C,null,Y(N.value,l=>(u(),k(b,{key:l.value,label:l.display,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(y,{label:"状态"},{default:n(()=>[a(D,{modelValue:s.value.status,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.status=l),placeholder:"选择状态",clearable:""},{default:n(()=>[a(b,{label:"成功",value:"success"}),a(b,{label:"失败",value:"failed"})]),_:1},8,["modelValue"])]),_:1}),a(y,null,{default:n(()=>[a(x,{type:"primary",onClick:g},{default:n(()=>[a(V,null,{default:n(()=>[a(M(J))]),_:1}),e[5]||(e[5]=r(" 搜索 "))]),_:1}),a(x,{onClick:z},{default:n(()=>[a(V,null,{default:n(()=>[a(M(K))]),_:1}),e[6]||(e[6]=r(" 重置 "))]),_:1})]),_:1})]),_:1},8,["model"])]),h.value?(u(),_("div",ne,[a(P,{rows:10,animated:""})])):p.value.length===0?(u(),_("div",se,[a(j,{description:"暂无日志数据"})])):(u(),_("div",oe,[a(O,{data:p.value,border:"",stripe:""},{default:n(()=>[a(d,{prop:"id",label:"ID",width:"80"}),a(d,{label:"用户",width:"120"},{default:n(({row:l})=>[r(m(l.user.username),1)]),_:1}),a(d,{label:"操作类型",width:"150"},{default:n(({row:l})=>[r(m(l.action_display),1)]),_:1}),a(d,{label:"目标ID",width:"100"},{default:n(({row:l})=>[r(m(l.target_id),1)]),_:1}),a(d,{label:"状态",width:"100"},{default:n(({row:l})=>[a(A,{type:l.status==="success"?"success":"danger"},{default:n(()=>[r(m(l.status_display),1)]),_:2},1032,["type"])]),_:1}),a(d,{label:"消息内容","min-width":"300"},{default:n(({row:l})=>[r(m(l.message),1)]),_:1}),a(d,{label:"时间",width:"180"},{default:n(({row:l})=>[r(m(U(l.created_at)),1)]),_:1})]),_:1},8,["data"]),v("div",ue,[w.value>0?(u(),k(Q,{key:0,background:"",layout:"prev, pager, next",total:w.value,"page-size":B.value,"current-page":f.value,onCurrentChange:F},null,8,["total","page-size","current-page"])):W("",!0)])]))]),_:1})])}}},_e=Z(re,[["__scopeId","data-v-84b80c31"]]);export{_e as default};

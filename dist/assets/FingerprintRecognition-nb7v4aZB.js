import{i as ue,r as m,o as ie,a as o,b as r,c as _,e as a,w as t,g as d,q as v,t as x,d as u,F as N,y as S,v as h,E as y,z as de}from"./index-BxO9RYUF.js";import{g as P,a as ce,b as pe,r as me,d as _e,c as fe}from"./task-CoA4MaqV.js";import{_ as ve}from"./_plugin-vue_export-helper-xacGa6pw.js";const ye={class:"fingerprint-recognition"},ge={class:"card-header"},ke={key:0,class:"loading-results"},he={key:1,class:"no-results"},be={key:2,class:"results-container"},we={class:"result-header"},Te={key:0,class:"result-components"},xe={class:"result-resources"},Ce={class:"result-headers"},Re={class:"view-report"},Ve={__name:"FingerprintRecognition",setup(Le){const J=ue(),z=m(null),C=m(!1),B=m(!1),n=m(null),g=m([]),k=m([]),R=m(null),p=m({url:"",mode:"simple",depth:1}),X={};function G(l){if(!l)return"";const e=new Date(l);return new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(e)}function H(l){switch(l){case"queued":return"info";case"running":return"warning";case"completed":return"success";case"failed":return"danger";default:return"info"}}function I(l){const e=l.split(".").pop().toLowerCase(),c=e.indexOf("?"),i=c>-1?e.substring(0,c):e;return{js:"脚本",css:"样式表",jpg:"图片",jpeg:"图片",png:"图片",gif:"图片",svg:"图片",ico:"图标",woff:"字体",woff2:"字体",ttf:"字体",eot:"字体",html:"HTML",htm:"HTML",json:"JSON",xml:"XML"}[i]||"其他"}function K(l){return!l||!Array.isArray(l)?[]:l.map(e=>({url:e,type:I(e)}))}async function Q(){z.value.validate(async l=>{if(!l)return!1;C.value=!0;try{const e=await fe(p.value);y.success("任务已提交"),n.value=e,await V(),F(e.id),C.value=!1}catch(e){console.error("提交任务失败:",e),C.value=!1}})}async function V(){try{const l=await P();k.value=l.results}catch(l){console.error("获取任务列表失败:",l)}}async function j(l){B.value=!0,g.value=[];try{const c=(await P()).results.find(w=>w.id===l);c&&(n.value=c,F(l));const i=await pe(l);i&&i.results&&(g.value=i.results)}catch(e){console.error("获取任务结果失败:",e),y.error("获取任务结果失败")}finally{B.value=!1}}function W(){n.value&&J.push({path:"/recognition-reports",query:{taskId:n.value.id}})}async function Y(l){try{await me(l),y.success("任务已重新启动"),await V(),n.value&&n.value.id===l&&F(l)}catch(e){console.error("重启任务失败:",e),y.error("重启任务失败")}}async function Z(l){de.confirm("确定要删除该任务吗？此操作将同时删除相关的结果和报告。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await _e(l),y.success("任务已删除"),await V(),n.value&&n.value.id===l&&(n.value=null,g.value=[],b())}catch(e){console.error("删除任务失败:",e),y.error("删除任务失败")}}).catch(()=>{})}function F(l){b(),q(l),R.value=setInterval(()=>{q(l)},3e3)}function b(){R.value&&(clearInterval(R.value),R.value=null)}async function q(l){try{const e=await ce(l);n.value&&n.value.id===l&&(n.value.status=e.status,n.value.status_display=e.status_display,e.status==="completed"?(b(),j(l)):e.status==="failed"&&(b(),y.error("任务执行失败")));const c=k.value.findIndex(i=>i.id===l);c>-1&&(k.value[c].status=e.status,k.value[c].status_display=e.status_display)}catch(e){console.error("检查任务状态失败:",e),b()}}return ie(async()=>{await V()}),(l,e)=>{const c=o("el-input"),i=o("el-form-item"),w=o("el-radio"),ee=o("el-radio-group"),te=o("el-input-number"),T=o("el-button"),le=o("el-form"),L=o("el-card"),D=o("el-tag"),ae=o("el-skeleton"),se=o("el-space"),f=o("el-table-column"),E=o("el-table"),$=o("el-collapse-item"),A=o("el-collapse"),ne=o("el-descriptions-item"),oe=o("el-descriptions"),re=o("el-button-group");return r(),_("div",ye,[a(L,{class:"recognition-card"},{header:t(()=>e[3]||(e[3]=[u("div",{class:"card-header"},[u("h2",null,"指纹识别"),u("span",null,"输入目标网站URL，系统将识别其使用的前端组件")],-1)])),default:t(()=>[a(le,{ref_key:"searchForm",ref:z,model:p.value,rules:X,"label-width":"100px",class:"search-form"},{default:t(()=>[a(i,{label:"目标URL",prop:"url"},{default:t(()=>[a(c,{modelValue:p.value.url,"onUpdate:modelValue":e[0]||(e[0]=s=>p.value.url=s),placeholder:"请输入网站URL，例如：https://example.com",clearable:""},null,8,["modelValue"])]),_:1}),a(i,{label:"爬取模式",prop:"mode"},{default:t(()=>[a(ee,{modelValue:p.value.mode,"onUpdate:modelValue":e[1]||(e[1]=s=>p.value.mode=s)},{default:t(()=>[a(w,{label:"simple"},{default:t(()=>e[4]||(e[4]=[d("简单模式")])),_:1}),a(w,{label:"deep"},{default:t(()=>e[5]||(e[5]=[d("深度模式")])),_:1})]),_:1},8,["modelValue"])]),_:1}),p.value.mode==="deep"?(r(),v(i,{key:0,label:"爬取深度",prop:"depth"},{default:t(()=>[a(te,{modelValue:p.value.depth,"onUpdate:modelValue":e[2]||(e[2]=s=>p.value.depth=s),min:1,max:5},null,8,["modelValue"])]),_:1})):x("",!0),a(i,null,{default:t(()=>[a(T,{type:"primary",loading:C.value,onClick:Q},{default:t(()=>e[6]||(e[6]=[d(" 开始识别 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),g.value.length>0?(r(),v(L,{key:0,class:"results-card"},{header:t(()=>[u("div",ge,[e[7]||(e[7]=u("h2",null,"识别结果",-1)),n.value?(r(),v(D,{key:0,type:H(n.value.status)},{default:t(()=>[d(h(n.value.status_display),1)]),_:1},8,["type"])):x("",!0)])]),default:t(()=>[B.value?(r(),_("div",ke,[a(ae,{rows:10,animated:""})])):g.value.length===0?(r(),_("div",he," 暂无识别结果，请等待识别完成。 ")):(r(),_("div",be,[(r(!0),_(N,null,S(g.value,(s,M)=>(r(),v(L,{key:M,class:"result-item",shadow:"hover"},{header:t(()=>[u("div",we,[u("h3",null,h(s.url),1)])]),default:t(()=>[s.components.length>0?(r(),_("div",Te,[e[8]||(e[8]=u("h4",null,"检测到的组件：",-1)),a(se,{wrap:""},{default:t(()=>[(r(!0),_(N,null,S(s.components,U=>(r(),v(D,{key:U.id,type:"success"},{default:t(()=>[d(h(U.component),1)]),_:2},1024))),128))]),_:2},1024)])):x("",!0),u("div",xe,[e[9]||(e[9]=u("h4",null,"检测到的资源：",-1)),a(A,null,{default:t(()=>[a($,{title:"查看资源列表",name:"1"},{default:t(()=>[a(E,{data:K(s.resources),stripe:""},{default:t(()=>[a(f,{label:"资源URL",prop:"url"}),a(f,{label:"资源类型",prop:"type",width:"120"})]),_:2},1032,["data"])]),_:2},1024)]),_:2},1024)]),u("div",Ce,[e[10]||(e[10]=u("h4",null,"HTTP 头信息：",-1)),a(A,null,{default:t(()=>[a($,{title:"查看头信息",name:"1"},{default:t(()=>[a(oe,{column:1,border:""},{default:t(()=>[(r(!0),_(N,null,S(s.headers,(U,O)=>(r(),v(ne,{key:O,label:O},{default:t(()=>[d(h(U),1)]),_:2},1032,["label"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1024))),128)),u("div",Re,[a(T,{type:"primary",onClick:W,disabled:!n.value||n.value.status!=="completed"},{default:t(()=>e[11]||(e[11]=[d(" 查看详细报告 ")])),_:1},8,["disabled"])])]))]),_:1})):x("",!0),k.value.length>0?(r(),v(L,{key:1,class:"recent-tasks-card"},{header:t(()=>e[12]||(e[12]=[u("div",{class:"card-header"},[u("h2",null,"近期任务")],-1)])),default:t(()=>[a(E,{data:k.value,stripe:"",border:""},{default:t(()=>[a(f,{label:"URL",prop:"url"}),a(f,{label:"模式",prop:"mode_display",width:"100"}),a(f,{label:"状态",width:"120"},{default:t(({row:s})=>[a(D,{type:H(s.status)},{default:t(()=>[d(h(s.status_display),1)]),_:2},1032,["type"])]),_:1}),a(f,{label:"创建时间",width:"180"},{default:t(({row:s})=>[d(h(G(s.created_at)),1)]),_:1}),a(f,{label:"操作",width:"200"},{default:t(({row:s})=>[a(re,null,{default:t(()=>[a(T,{size:"small",onClick:M=>j(s.id),type:"primary"},{default:t(()=>e[13]||(e[13]=[d(" 查看结果 ")])),_:2},1032,["onClick"]),a(T,{size:"small",type:"warning",disabled:s.status!=="completed"&&s.status!=="failed",onClick:M=>Y(s.id)},{default:t(()=>e[14]||(e[14]=[d(" 重新运行 ")])),_:2},1032,["disabled","onClick"]),a(T,{size:"small",type:"danger",onClick:M=>Z(s.id)},{default:t(()=>e[15]||(e[15]=[d(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1})):x("",!0)])}}},Fe=ve(Ve,[["__scopeId","data-v-c207a19f"]]);export{Fe as default};

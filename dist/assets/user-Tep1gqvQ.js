import{I as c,E as n}from"./index-BxO9RYUF.js";import{h as o}from"./_plugin-vue_export-helper-xacGa6pw.js";function l(e){return o.post("/users/login/",e)}function i(e){return o.post("/users/register/",e)}function g(){return o.post("/users/logout/")}function a(){return o.get("/users/me/")}function f(){return o.get("/users/")}function d(e){return o.post("/users/",e)}function p(e,r){return o.patch(`/users/${e}/`,r)}function I(e){return o.delete(`/users/${e}/`)}const S=c("user",{state:()=>({user:JSON.parse(localStorage.getItem("user"))||null,isAuthenticated:!!localStorage.getItem("user")}),getters:{isAdmin:e=>{var r,s;return((s=(r=e.user)==null?void 0:r.profile)==null?void 0:s.role)==="admin"},username:e=>{var r;return(r=e.user)==null?void 0:r.username}},actions:{async login(e){var r,s;try{console.log("正在尝试登录...",e.username);const t=await l(e);console.log("登录API返回:",t),console.log("获取用户信息...");const u=await a();return console.log("用户信息API返回:",u),this.user=u,this.isAuthenticated=!0,localStorage.setItem("user",JSON.stringify(u)),u}catch(t){throw console.error("登录过程发生错误:",t),n.error(((s=(r=t.response)==null?void 0:r.data)==null?void 0:s.detail)||"登录失败，请重试"),t}},async register(e){var r,s;try{console.log("正在尝试注册...",e.username);const t=await i(e);return console.log("注册API返回:",t),n.success("注册成功，请登录"),t}catch(t){throw console.error("注册过程发生错误:",t),n.error(((s=(r=t.response)==null?void 0:r.data)==null?void 0:s.detail)||"注册失败，请重试"),t}},async logout(){try{console.log("正在退出登录..."),await g(),this.user=null,this.isAuthenticated=!1,localStorage.removeItem("user"),n.success("已退出登录")}catch(e){throw console.error("退出登录失败",e),n.error("退出登录失败，请重试"),e}},async fetchUserInfo(){try{console.log("获取用户信息...");const e=await a();return console.log("用户信息API返回:",e),this.user=e,this.isAuthenticated=!0,localStorage.setItem("user",JSON.stringify(e)),e}catch(e){throw console.error("获取用户信息失败",e),this.user=null,this.isAuthenticated=!1,localStorage.removeItem("user"),e}}}});export{p as a,d as c,I as d,f as g,S as u};

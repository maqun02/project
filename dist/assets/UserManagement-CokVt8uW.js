import{u as Z,g as ee,a as F,d as le,c as ae}from"./user-Tep1gqvQ.js";import{p as te,r,o as oe,E as i,a as s,b as f,c as V,e as l,w as o,d as v,g as u,v as U,z as I,u as se,C as ne,q as re,t as ue}from"./index-BxO9RYUF.js";import{_ as ie}from"./_plugin-vue_export-helper-xacGa6pw.js";const de={class:"user-management"},ce={class:"card-header"},me={class:"header-actions"},pe={class:"search-container"},_e={key:0,class:"loading-container"},fe={key:1,class:"empty-container"},ve={key:2,class:"users-table"},ye={class:"dialog-footer"},ge={__name:"UserManagement",setup(be){const M=Z(),B=te(()=>M.user),k=r(!1),h=r([]),y=r([]),g=r(""),c=r(!1),C=r(!1),p=r(!1),x=r(null),n=r({username:"",email:"",password:"",role:"user",is_active:!0}),N=r(null),L={};function S(t){if(!t)return"";const e=new Date(t);return new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(e)}function q(){p.value=!1,x.value=null,n.value={username:"",email:"",password:"",role:"user",is_active:!0},c.value=!0}function R(t){p.value=!0,x.value=t.id,n.value={username:t.username,email:t.email,role:t.profile.role,is_active:t.is_active},c.value=!0}function j(t){const e=t.is_active?"禁用":"激活";I.confirm(`确定要${e}用户 "${t.username}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await F(t.id,{is_active:!t.is_active}),i.success(`用户已${e}`),b()}catch($){console.error(`${e}用户失败:`,$),i.error(`${e}用户失败`)}}).catch(()=>{})}function A(t){if(t.id===B.value.id){i.warning("不能删除当前登录的用户");return}I.confirm(`确定要删除用户 "${t.username}" 吗？此操作不可恢复。`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await le(t.id),i.success("用户已删除"),b()}catch(e){console.error("删除用户失败:",e),i.error("删除用户失败")}}).catch(()=>{})}function Q(){N.value.validate(async t=>{if(!t)return!1;C.value=!0;try{const e={...n.value};e.profile={role:e.role},delete e.role,p.value?(delete e.password,await F(x.value,e),i.success("用户已更新")):(await ae(e),i.success("用户已创建")),c.value=!1,b()}catch(e){console.error("保存用户失败:",e)}finally{C.value=!1}})}async function b(){k.value=!0;try{const t=await ee();h.value=t.results||[],D()}catch(t){console.error("获取用户列表失败:",t),i.error("获取用户列表失败")}finally{k.value=!1}}function D(){if(!g.value){y.value=h.value;return}const t=g.value.toLowerCase();y.value=h.value.filter(e=>e.username.toLowerCase().includes(t)||e.email.toLowerCase().includes(t))}return oe(()=>{b()}),(t,e)=>{const $=s("el-icon"),m=s("el-button"),w=s("el-input"),G=s("el-skeleton"),H=s("el-empty"),d=s("el-table-column"),T=s("el-tag"),J=s("el-button-group"),K=s("el-table"),O=s("el-card"),_=s("el-form-item"),z=s("el-option"),P=s("el-select"),W=s("el-switch"),X=s("el-form"),Y=s("el-dialog");return f(),V("div",de,[l(O,{class:"user-card"},{header:o(()=>[v("div",ce,[e[9]||(e[9]=v("h2",null,"用户管理",-1)),v("div",me,[l(m,{type:"primary",onClick:q},{default:o(()=>[l($,null,{default:o(()=>[l(se(ne))]),_:1}),e[8]||(e[8]=u(" 新增用户 "))]),_:1})])])]),default:o(()=>[v("div",pe,[l(w,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=a=>g.value=a),placeholder:"搜索用户名或邮箱","prefix-icon":"Search",clearable:"",onInput:D},null,8,["modelValue"])]),k.value?(f(),V("div",_e,[l(G,{rows:10,animated:""})])):y.value.length===0?(f(),V("div",fe,[l(H,{description:"暂无用户数据"})])):(f(),V("div",ve,[l(K,{data:y.value,border:"",stripe:""},{default:o(()=>[l(d,{prop:"id",label:"ID",width:"80"}),l(d,{prop:"username",label:"用户名"}),l(d,{prop:"email",label:"邮箱"}),l(d,{label:"角色",width:"120"},{default:o(({row:a})=>[l(T,{type:a.profile.role==="admin"?"danger":"success"},{default:o(()=>[u(U(a.profile.role==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),l(d,{label:"状态",width:"120"},{default:o(({row:a})=>[l(T,{type:a.is_active?"success":"info"},{default:o(()=>[u(U(a.is_active?"激活":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(d,{label:"注册时间",width:"180"},{default:o(({row:a})=>[u(U(S(a.date_joined)),1)]),_:1}),l(d,{label:"操作",width:"200",fixed:"right"},{default:o(({row:a})=>[l(J,null,{default:o(()=>[l(m,{size:"small",type:"primary",onClick:E=>R(a)},{default:o(()=>e[10]||(e[10]=[u(" 编辑 ")])),_:2},1032,["onClick"]),l(m,{size:"small",type:a.is_active?"warning":"success",onClick:E=>j(a)},{default:o(()=>[u(U(a.is_active?"禁用":"激活"),1)]),_:2},1032,["type","onClick"]),l(m,{size:"small",type:"danger",disabled:a.id===B.value.id,onClick:E=>A(a)},{default:o(()=>e[11]||(e[11]=[u(" 删除 ")])),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])]))]),_:1}),l(Y,{modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=a=>c.value=a),title:p.value?"编辑用户":"新增用户",width:"30%","close-on-click-modal":!1},{footer:o(()=>[v("div",ye,[l(m,{onClick:e[6]||(e[6]=a=>c.value=!1)},{default:o(()=>e[12]||(e[12]=[u("取消")])),_:1}),l(m,{type:"primary",loading:C.value,onClick:Q},{default:o(()=>e[13]||(e[13]=[u("确定")])),_:1},8,["loading"])])]),default:o(()=>[l(X,{ref_key:"userForm",ref:n,model:n.value,rules:L,"label-width":"100px"},{default:o(()=>[l(_,{label:"用户名",prop:"username"},{default:o(()=>[l(w,{modelValue:n.value.username,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.username=a),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(_,{label:"邮箱",prop:"email"},{default:o(()=>[l(w,{modelValue:n.value.email,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.email=a),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),p.value?ue("",!0):(f(),re(_,{key:0,label:"密码",prop:"password"},{default:o(()=>[l(w,{modelValue:n.value.password,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.password=a),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),l(_,{label:"角色",prop:"role"},{default:o(()=>[l(P,{modelValue:n.value.role,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.role=a),placeholder:"请选择角色"},{default:o(()=>[l(z,{label:"普通用户",value:"user"}),l(z,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"状态",prop:"is_active"},{default:o(()=>[l(W,{modelValue:n.value.is_active,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.is_active=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ke=ie(ge,[["__scopeId","data-v-096a7e7a"]]);export{ke as default};

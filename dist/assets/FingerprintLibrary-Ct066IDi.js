import{u as pe}from"./user-Tep1gqvQ.js";import{p as H,r as d,o as me,E as V,a as s,b as f,c as h,e as t,w as l,d as r,u as F,A as fe,g as u,B as _e,C as ve,F as z,y as J,q as T,v as x,f as ge,D as ye,t as A,z as ke}from"./index-BxO9RYUF.js";import{h as w,_ as we}from"./_plugin-vue_export-helper-xacGa6pw.js";function be(){return w.get("/fingerprints/")}function Ce(m){return w.post("/fingerprints/submit/",m)}function Ve(){return w.get("/fingerprints/pending/")}function he(m,v){return w.put(`/fingerprints/${m}/approve/`,v)}function Fe(m,v){return w.patch(`/fingerprints/${m}/`,v)}function xe(m){return w.delete(`/fingerprints/${m}/`)}const ze={class:"fingerprint-library"},$e={class:"card-header"},Be={class:"header-actions"},Le={class:"filter-container"},Ue={class:"fingerprint-list"},Me={class:"fingerprint-header"},De={class:"fingerprint-keyword"},Ne={class:"fingerprint-status"},Te={class:"fingerprint-component"},Ae={class:"fingerprint-info"},Ee={class:"info-item"},Se={class:"info-item"},je={class:"fingerprint-actions"},Pe={class:"pagination-container"},Ie={class:"dialog-footer"},Re={__name:"FingerprintLibrary",setup(m){const v=pe(),$=H(()=>v.isAdmin),K=H(()=>v.user),B=d(!1),b=d([]),L=d(0),E=d(1),O=d(12),c=d({keyword:"",component:""}),g=d(!1),U=d(!1),C=d(null),Q=d(null),a=d({keyword:"",component:"",status:""}),W={};function X(o){if(!o)return"";const e=new Date(o);return new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).format(e)}function Y(o){switch(o){case"pending":return"warning";case"approved":return"success";case"rejected":return"danger";default:return"info"}}function Z(){a.value={keyword:"",component:"",status:""},_()}function ee(){C.value=null,c.value={keyword:"",component:""},g.value=!0}function te(o){C.value=o,c.value={keyword:o.keyword,component:o.component},g.value=!0}function le(){Q.value.validate(async o=>{if(!o)return!1;U.value=!0;try{C.value?(await Fe(C.value.id,c.value),V.success("指纹已更新")):(await Ce(c.value),V.success("指纹已提交，等待管理员审核")),g.value=!1,_()}catch(e){console.error("保存指纹失败:",e)}finally{U.value=!1}})}async function S(o,e){try{await he(o,{status:e}),V.success(e==="approved"?"指纹已审核通过":"指纹已拒绝"),_()}catch(p){console.error("审核指纹失败:",p)}}function ne(o){ke.confirm("确定要删除该指纹吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await xe(o),V.success("指纹已删除"),_()}catch(e){console.error("删除指纹失败:",e)}}).catch(()=>{})}async function _(){B.value=!0;try{let o;$.value&&a.value.status==="pending"?o=await Ve():o=await be(),b.value=o.results||[],L.value=o.count||0,(a.value.keyword||a.value.component||a.value.status)&&(b.value=b.value.filter(e=>{const p=!a.value.keyword||e.keyword.toLowerCase().includes(a.value.keyword.toLowerCase()),i=!a.value.component||e.component.toLowerCase().includes(a.value.component.toLowerCase()),y=!a.value.status||e.status===a.value.status;return p&&i&&y}))}catch(o){console.error("获取指纹列表失败:",o),V.error("获取指纹列表失败")}finally{B.value=!1}}function oe(o){E.value=o,_()}return me(()=>{_()}),(o,e)=>{const p=s("el-icon"),i=s("el-button"),y=s("el-input"),k=s("el-form-item"),M=s("el-option"),ae=s("el-select"),j=s("el-form"),P=s("el-card"),se=s("el-skeleton"),D=s("el-col"),re=s("el-empty"),I=s("el-tag"),ue=s("el-button-group"),ie=s("el-row"),de=s("el-pagination"),ce=s("el-dialog");return f(),h("div",ze,[t(P,{class:"filter-card"},{header:l(()=>[r("div",$e,[e[8]||(e[8]=r("h2",null,"指纹库管理",-1)),r("div",Be,[t(i,{type:"primary",onClick:ee},{default:l(()=>[t(p,null,{default:l(()=>[t(F(ve))]),_:1}),e[7]||(e[7]=u(" 新增指纹 "))]),_:1})])])]),default:l(()=>[r("div",Le,[t(j,{inline:!0,model:a.value,class:"filter-form"},{default:l(()=>[t(k,{label:"关键词"},{default:l(()=>[t(y,{modelValue:a.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.keyword=n),placeholder:"搜索关键词",clearable:""},null,8,["modelValue"])]),_:1}),t(k,{label:"组件名称"},{default:l(()=>[t(y,{modelValue:a.value.component,"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.component=n),placeholder:"搜索组件名称",clearable:""},null,8,["modelValue"])]),_:1}),t(k,{label:"状态"},{default:l(()=>[t(ae,{modelValue:a.value.status,"onUpdate:modelValue":e[2]||(e[2]=n=>a.value.status=n),placeholder:"选择状态",clearable:""},{default:l(()=>[t(M,{label:"待审核",value:"pending"}),t(M,{label:"已通过",value:"approved"}),t(M,{label:"已拒绝",value:"rejected"})]),_:1},8,["modelValue"])]),_:1}),t(k,null,{default:l(()=>[t(i,{type:"primary",onClick:_},{default:l(()=>[t(p,null,{default:l(()=>[t(F(fe))]),_:1}),e[9]||(e[9]=u(" 搜索 "))]),_:1}),t(i,{onClick:Z},{default:l(()=>[t(p,null,{default:l(()=>[t(F(_e))]),_:1}),e[10]||(e[10]=u(" 重置 "))]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1}),r("div",Ue,[t(ie,{gutter:20},{default:l(()=>[B.value?(f(),h(z,{key:0},J(6,n=>t(D,{key:n,xs:24,sm:12,md:8,lg:8,xl:6},{default:l(()=>[t(se,{style:{width:"100%"},rows:6,animated:""})]),_:2},1024)),64)):b.value.length===0?(f(),T(D,{key:1,span:24},{default:l(()=>[t(re,{description:"暂无指纹数据"})]),_:1})):(f(!0),h(z,{key:2},J(b.value,n=>(f(),T(D,{key:n.id,xs:24,sm:12,md:8,lg:8,xl:6},{default:l(()=>[t(P,{class:"fingerprint-card",shadow:"hover"},{default:l(()=>{var R;return[r("div",Me,[r("div",De,[t(I,{size:"large"},{default:l(()=>[u(x(n.keyword),1)]),_:2},1024)]),r("div",Ne,[t(I,{type:Y(n.status)},{default:l(()=>[u(x(n.status_display),1)]),_:2},1032,["type"])])]),r("div",Te,[r("h3",null,x(n.component),1)]),r("div",Ae,[r("div",Ee,[t(p,null,{default:l(()=>[t(F(ge))]),_:1}),u(" 提交人: "+x(((R=n.submitter)==null?void 0:R.username)||"未知"),1)]),r("div",Se,[t(p,null,{default:l(()=>[t(F(ye))]),_:1}),u(" "+x(X(n.created_at)),1)])]),r("div",je,[t(ue,null,{default:l(()=>{var q,G;return[$.value&&n.status==="pending"?(f(),h(z,{key:0},[t(i,{type:"success",size:"small",onClick:N=>S(n.id,"approved")},{default:l(()=>e[11]||(e[11]=[u(" 审核通过 ")])),_:2},1032,["onClick"]),t(i,{type:"danger",size:"small",onClick:N=>S(n.id,"rejected")},{default:l(()=>e[12]||(e[12]=[u(" 拒绝 ")])),_:2},1032,["onClick"])],64)):A("",!0),$.value||((q=n.submitter)==null?void 0:q.id)===((G=K.value)==null?void 0:G.id)?(f(),h(z,{key:1},[t(i,{type:"primary",size:"small",onClick:N=>te(n)},{default:l(()=>e[13]||(e[13]=[u(" 编辑 ")])),_:2},1032,["onClick"]),t(i,{type:"danger",size:"small",onClick:N=>ne(n.id)},{default:l(()=>e[14]||(e[14]=[u(" 删除 ")])),_:2},1032,["onClick"])],64)):A("",!0)]}),_:2},1024)])]}),_:2},1024)]),_:2},1024))),128))]),_:1}),r("div",Pe,[L.value>0?(f(),T(de,{key:0,background:"",layout:"prev, pager, next",total:L.value,"page-size":O.value,"current-page":E.value,onCurrentChange:oe},null,8,["total","page-size","current-page"])):A("",!0)])]),t(ce,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=n=>g.value=n),title:C.value?"编辑指纹":"新增指纹",width:"30%","close-on-click-modal":!1},{footer:l(()=>[r("div",Ie,[t(i,{onClick:e[5]||(e[5]=n=>g.value=!1)},{default:l(()=>e[15]||(e[15]=[u("取消")])),_:1}),t(i,{type:"primary",loading:U.value,onClick:le},{default:l(()=>e[16]||(e[16]=[u("确定")])),_:1},8,["loading"])])]),default:l(()=>[t(j,{ref_key:"fingerprintForm",ref:c,model:c.value,rules:W,"label-width":"100px"},{default:l(()=>[t(k,{label:"关键词",prop:"keyword"},{default:l(()=>[t(y,{modelValue:c.value.keyword,"onUpdate:modelValue":e[3]||(e[3]=n=>c.value.keyword=n),placeholder:"请输入关键词"},null,8,["modelValue"])]),_:1}),t(k,{label:"组件名称",prop:"component"},{default:l(()=>[t(y,{modelValue:c.value.component,"onUpdate:modelValue":e[4]||(e[4]=n=>c.value.component=n),placeholder:"请输入组件名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Je=we(Re,[["__scopeId","data-v-7261c92f"]]);export{Je as default};

服务端地址：http://fwf.ns-6k0uv9r0.svc.cluster.local:8000
# 接口调用文档

## 1. 用户管理接口
## admin
### 1.1 获取用户列表（管理员）
- **请求类型**: GET
- **请求路径**: `/api/users/`
- **请求参数**: 无
- **返回结果**:
  ```json
  {
    "count": 5,
    "next": null,
    "previous": null,
    "results": [
      {
        "id": 1,
        "username": "admin",
        "email": "admin@example.com",
        "profile": {
          "role": "admin",
          "created_at": "2023-11-09T12:00:00Z",
          "updated_at": "2023-11-09T12:00:00Z"
        },
        "is_active": true,
        "date_joined": "2023-11-09T12:00:00Z"
      },
      // 更多用户...
    ]
  }
  ```

### 1.2 创建用户（管理员）
- **请求类型**: POST
- **请求路径**: `/api/users/`
- **请求参数**:
  ```json
  {
    "username": "newuser",
    "email": "newuser@example.com",
    "password": "securepassword",
    "profile": {
      "role": "user"  // 或 "admin"
    }
  }
  ```
- **返回结果**: 创建的用户对象

### 1.3 获取单个用户（管理员）
- **请求类型**: GET
- **请求路径**: `/api/users/{id}/`
- **请求参数**: 无
- **返回结果**: 用户对象

### 1.4 更新用户（管理员）
- **请求类型**: PUT 或 PATCH
- **请求路径**: `/api/users/{id}/`
- **请求参数**: 用户对象（全部或部分字段）
- **返回结果**: 更新后的用户对象

### 1.5 删除用户（管理员）
- **请求类型**: DELETE
- **请求路径**: `/api/users/{id}/`
- **请求参数**: 无
- **返回结果**: 204 No Content

### 1.6 重置用户密码（管理员）
- **请求类型**: POST
- **请求路径**: `/api/users/reset_password/`
- **请求参数**:
  ```json
  {
    "target_id": 1  // 用户ID（数字）或用户名（字符串）
  }
  ```
- **返回结果**:
  ```json
  {
    "detail": "用户密码已重置为: 123456"
  }
  ```

## user
### 1.1 用户注册
- **请求类型**: POST
- **请求路径**: `/api/users/register/`
- **请求参数**:
  ```json
  {
    "username": "用户名",
    "email": "邮箱",
    "password": "密码",
    "password_confirm": "确认密码"
  }
  ```
- **返回结果**:
  ```json
  {
    "detail": "注册成功"
  }
  ```

### 1.2 用户登录
- **请求类型**: POST
- **请求路径**: `/api/users/login/`
- **请求参数**:
  ```json
  {
    "username": "用户名",
    "password": "密码"
  }
  ```
- **返回结果**:
  ```json
  {
    "detail": "登录成功"
  }
  ```

### 1.3 用户登出
- **请求类型**: POST
- **请求路径**: `/api/users/logout/`
- **请求参数**: 无
- **返回结果**:
  ```json
  {
    "detail": "登出成功"
  }
  ```

### 1.4 获取当前用户信息
- **请求类型**: GET
- **请求路径**: `/api/users/me/`
- **请求参数**: 无
- **返回结果**:
  ```json
  {
    "id": 1,
    "username": "admin",
    "email": "admin@example.com",
    "profile": {
      "role": "admin",
      "created_at": "2023-11-09T12:00:00Z",
      "updated_at": "2023-11-09T12:00:00Z"
    },
    "is_active": true,
    "date_joined": "2023-11-09T12:00:00Z"
  }
  ```

## 2. 指纹管理接口
## admin
### 2.1 审核指纹（管理员）
- **请求类型**: PUT
- **请求路径**: `/api/fingerprints/{id}/approve/`
- **请求参数**:
  ```json
  {
    "status": "approved"  // 或 "rejected"
  }
  ```
- **返回结果**:
  ```json
  {
    "detail": "指纹审核通过"  // 或 "指纹审核拒绝"
  }
  ```

### 2.2 获取待审核指纹列表（管理员）
- **请求类型**: GET
- **请求路径**: `/api/fingerprints/pending/`
- **请求参数**: 无
- **返回结果**:
  ```json
  {
    "count": 10,
    "next": "http://localhost:8000/api/fingerprints/pending/?page=2",
    "previous": null,
    "results": [
      {
        "id": 1,
        "keyword": "jquery-3.5.1",
        "component": "jQuery",
        "status": "pending",
        "status_display": "待审核",
        "submitter": {
          "id": 2,
          "username": "user1"
        },
        "admin": null,
        "created_at": "2023-11-09T12:00:00Z",
        "updated_at": "2023-11-09T12:00:00Z"
      },
      // 更多指纹...
    ]
  }
  ```

### 2.3 更新指纹（管理员）
- **请求类型**: PUT 或 PATCH
- **请求路径**: `/api/fingerprints/{id}/`
- **请求参数**: 指纹对象（全部或部分字段）
- **返回结果**: 更新后的指纹对象

### 2.4 删除指纹（管理员）
- **请求类型**: DELETE
- **请求路径**: `/api/fingerprints/{id}/`
- **请求参数**: 无
- **返回结果**: 204 No Content
## user

### 2.1 获取指纹列表
- **请求类型**: GET
- **请求路径**: `/api/fingerprints/`
- **请求参数**: 无
- **返回结果**: 指纹列表（分页）

### 2.2 获取单个指纹详情
- **请求类型**: GET
- **请求路径**: `/api/fingerprints/{id}/`
- **请求参数**: 无
- **返回结果**: 指纹详情

### 2.3 提交指纹
- **请求类型**: POST
- **请求路径**: `/api/fingerprints/submit/`
- **请求参数**:
  ```json
  {
    "keyword": "特征关键词",
    "component": "组件名称"
  }
  ```
- **返回结果**:
  ```json
  {
    "detail": "指纹提交成功，等待管理员审核"
  }
  ```

### 2.4 获取已审核通过的指纹列表
- **请求类型**: GET
- **请求路径**: `/api/fingerprints/approved/`
- **请求参数**: 无
- **返回结果**: 同上，但status为"approved"

## 指纹库API

### 批量添加指纹

- URL: `/api/fingerprints/batch-submit/`
- 方法: POST
- 权限: 需要认证
- 描述: 批量添加指纹数据

请求参数:

```json
{
  "fingerprints": [
    {
      "keyword": "example.com",
      "component": "Example Website"
    },
    {
      "keyword": "api.test",
      "component": "API测试组件"
    }
  ]
}
```

成功响应:

```json
{
  "success": true,
  "message": "成功添加 X 条指纹数据",
  "results": {
    "total": 2,
    "successful": 2,
    "failed": 0,
    "failed_items": []
  }
}
```

失败响应:

```json
{
  "success": false,
  "message": "部分指纹数据添加失败",
  "results": {
    "total": 2,
    "successful": 1,
    "failed": 1,
    "failed_items": [
      {
        "keyword": "example.com",
        "component": "Example Website",
        "error": "指纹关键词已存在"
      }
    ]
  }
}
```

或

```json
{
  "detail": "请求格式错误",
  "errors": {
    "fingerprints": ["此字段是必需的。"]
  }
}
```

## 3. 查看指纹识别任务

### 3.1 创建指纹识别任务
- **请求类型**: POST
- **请求路径**: `/api/tasks/`
- **请求参数**:
  ```json
  {
    "url": "https://example.com",
    "mode": "simple", // 或 "deep"
    "depth": 2  // 深度模式的爬取深度，默认为1
  }
  ```
- **返回结果**:
  ```json
  {
    "id": 1,
    "url": "https://example.com",
    "mode": "simple",
    "mode_display": "简单模式",
    "status": "queued",
    "status_display": "排队中",
    "user": {
      "id": 1,
      "username": "admin"
    },
    "started_at": null,
    "ended_at": null,
    "depth": 2,
    "created_at": "2023-11-09T12:00:00Z"
  }
  ```
### 获取任务列表
- **请求类型**: GET
- **请求路径**: `/api/tasks/`
- **请求参数**: 无
- **返回结果**:
  ```json
  {
    "count": 10,
    "next": "http://localhost:8000/api/tasks/?page=2",
    "previous": null,
    "results": [
      {
        "id": 1,
        "url": "https://example.com",
        "mode": "simple",
        "mode_display": "简单模式",
        "status": "completed",
        "status_display": "已完成",
        "user": {
          "id": 1,
          "username": "admin"
        },
        "started_at": "2023-11-09T12:01:00Z",
        "ended_at": "2023-11-09T12:05:00Z",
        "depth": 1,
        "created_at": "2023-11-09T12:00:00Z"
      },
      // 更多任务...
    ]
  }
```

### ### 3.2 获取单个任务详情
- **请求类型**: GET
- **请求路径**: `/api/tasks/{id}/`
- **请求参数**: 无
- **返回结果**: 任务详情
- 
### 3.2 获取任务状态
- **请求类型**: GET
- **请求路径**: `/api/tasks/{id}/status/`
- **请求参数**: 无
- **返回结果**:
  ```json
  {
    "id": 1,
    "status": "running",
    "status_display": "运行中",
    "started_at": "2023-11-09T12:01:00Z",
    "ended_at": null
  }
  ```

### 3.3 重启任务
- **请求类型**: POST
- **请求路径**: `/api/tasks/{id}/restart/`
- **请求参数**: 无
- **返回结果**:
  ```json
  {
    "detail": "任务已重新启动"
  }
  ```

### 3.3 删除任务（会同时删除关联的结果和报告）
- **请求类型**: DELETE
- **请求路径**: `/api/tasks/{id}/`
- **请求参数**: 无
- **返回结果**: 204 No Content

## 4. 指纹识别结果查询接口

### 4.1 获取某任务的所有结果
- **请求类型**: GET
- **请求路径**: `/api/results/by_task/?task_id={id}`
- **请求参数**: 无（task_id在URL中指定）
- **返回结果**:
  ```json
  {
    "count": 3,
    "next": null,
    "previous": null,
    "results": [
      {
        "id": 1,
        "url": "https://example.com",
        "headers": {
          "content-type": "text/html",
          "server": "nginx"
        },
        "resources": [
          "https://example.com/style.css",
          "https://example.com/script.js"
        ],
        "components": [
          {
            "id": 1,
            "component": "jQuery",
            "keyword": "jquery-3.5.1",
            "created_at": "2023-11-09T12:05:00Z"
          }
        ],
        "created_at": "2023-11-09T12:05:00Z"
      },
      // 更多结果...
    ]
  }
  ```

### 4.2 获取任务分析报告
- **请求类型**: GET
- **请求路径**: `/api/results/report/?task_id={id}`
- **请求参数**: 无（task_id在URL中指定）
- **返回结果**:
  ```json
  {
    "task_id": 1,
    "url": "https://example.com",
    "pages": [
      {
        "url": "https://example.com",
        "resources": ["https://example.com/style.css", "https://example.com/script.js"],
        "components": ["jQuery", "Bootstrap"]
      },
      // 更多页面...
    ],
    "components": {
      "jQuery": ["https://example.com", "https://example.com/about"],
      "Bootstrap": ["https://example.com"]
    }
  }
  ```

## 5. 日志查询接口

### 5.1 获取系统日志（管理员）
- **请求类型**: GET
- **请求路径**: `/api/logs/`
- **请求参数**: 无
- **返回结果**:
  ```json
  {
    "count": 20,
    "next": "http://localhost:8000/api/logs/?page=2",
    "previous": null,
    "results": [
      {
        "id": 1,
        "user": {
          "id": 1,
          "username": "admin"
        },
        "action": "create_task",
        "action_display": "创建任务",
        "target_id": 1,
        "status": "success",
        "status_display": "成功",
        "message": "创建爬虫任务: https://example.com (简单模式)",
        "created_at": "2023-11-09T12:00:00Z"
      },
      // 更多日志...
    ]
  }
  ```

## 认证说明
- 除了`/api/users/register/`和`/api/users/login/`外，其他接口都需要用户登录
- 管理员角色可以访问所有资源，普通用户只能访问自己的资源
- 认证方式使用Session认证，需要先调用登录接口

## 4. 错误响应

### 4.1 认证错误
- **HTTP状态码**: 401 Unauthorized
- **响应内容**:
  ```json
  {
    "detail": "未提供有效的身份认证凭据"
  }
  ```

### 4.2 权限错误
- **HTTP状态码**: 403 Forbidden
- **响应内容**:
  ```json
  {
    "detail": "您没有执行该操作的权限"
  }
  ```

### 4.3 资源不存在
- **HTTP状态码**: 404 Not Found
- **响应内容**:
  ```json
  {
    "detail": "未找到指定的资源"
  }
  ```

### 4.4 请求参数错误
- **HTTP状态码**: 400 Bad Request
- **响应内容**:
  ```json
  {
    "keyword": ["此字段是必填项"],
    "component": ["该组件名称已存在"]
  }
  ```

### 4.5 服务器错误
- **HTTP状态码**: 500 Internal Server Error
- **响应内容**:
  ```json
  {
    "detail": "服务器内部错误"
  }
  ```

### 4.6 任务操作错误
- **HTTP状态码**: 400 Bad Request
- **响应内容**:
  ```json
  {
    "detail": "只有已完成或失败的任务才能重启"
  }
  ```

### 4.7 指纹审核错误
- **HTTP状态码**: 400 Bad Request
- **响应内容**:
  ```json
  {
    "status": ["状态只能是'approved'或'rejected'"]
  }
  ```

## 前端操作说明

### 管理员对用户的操作
1. **查看用户列表**: 访问用户管理页面，发送GET请求到`/api/users/`
2. **创建用户**: 在用户管理页提供表单，发送POST请求到`/api/users/`
3. **编辑用户**: 点击用户条目的"编辑"按钮，发送PUT/PATCH请求到`/api/users/{id}/`
4. **删除用户**: 点击用户条目的"删除"按钮，发送DELETE请求到`/api/users/{id}/`

### 管理员对指纹的操作
1. **查看所有指纹**: 访问指纹管理页面，发送GET请求到`/api/fingerprints/`
2. **审核指纹**: 查看待审核指纹(`/api/fingerprints/pending/`)，点击"通过"或"拒绝"按钮
3. **删除指纹**: 点击指纹条目的"删除"按钮，发送DELETE请求到`/api/fingerprints/{id}/`

### 指纹识别任务操作
1. **查看任务列表**: 访问任务管理页面，发送GET请求到`/api/tasks/`
2. **创建任务**: 在任务管理页提供表单，输入URL和爬取模式
3. **查看任务状态**: 任务列表中显示状态，或通过`/api/tasks/{id}/status/`查询
4. **查看结果**: 点击任务的"查看结果"按钮，跳转到结果页面
5. **删除任务**: 点击任务条目的"删除"按钮，系统会同时删除相关的结果和报告

系统中所有增删改查操作都通过REST API实现，前端负责展示界面并调用相应接口。


### 1.指纹数据查询
#### 请求参数
| 参数名 | 类型 | 说明 | 必填 |
| keyword | string | 关键词搜索（模糊匹配） | 否 |
| component | string | 组件名称搜索（模糊匹配） | 否 |
| status | string | 状态筛选 (pending/approved/rejected) | 否 |
| page | integer | 页码，默认为1 | 否 |
| page_size | integer | 每页数量，默认为10 | 否 |
#### 响应
json
Apply to FingerprintL...
{
  "count": 1062,
  "next": "http://example.com/api/fingerprints/search/?page=2&keyword=用友&page_size=10",
  "previous": null,
  "results": [
    {
      "id": 1,
      "keyword": "SHORTCUT ICON\\\" href=\\\"img/logo_small.ico\\\"",
      "component": "用友nc!!",
      "status": "approved",
      "status_display": "已通过",
      "submitter": {
        "id": 1,
        "username": "admin"
      },
      "created_at": "2023-05-06T08:30:00Z"
    },
    // ...更多结果
  ]
}
1. 后端应该直接在数据库层执行搜索，使用SQL的LIKE语句进行模糊匹配
2. 对于关键词和组件名称搜索

### 2.批量添加指纹
- URL: `/api/fingerprints/batch-submit/`
- 方法: POST
- 权限: 需要认证
- 描述: 批量添加指纹数据
请求参数:
```json
{
  "fingerprints": [
    {
      "keyword": "example.com",
      "component": "Example Website"
    },
    {
      "keyword": "api.test",
      "component": "API测试组件"
    }
  ]
}
```
成功响应:
```json
{
  "success": true,
  "message": "成功添加 X 条指纹数据",
  "results": {
    "total": 2,
    "successful": 2,
    "failed": 0,
    "failed_items": []
  }
}
```
失败响应:
```json
{
  "success": false,
  "message": "部分指纹数据添加失败",
  "results": {
    "total": 2,
    "successful": 1,
    "failed": 1,
    "failed_items": [
      {
        "keyword": "example.com",
        "component": "Example Website",
        "error": "指纹关键词已存在"
      }
    ]
  }
}
```
或
```json
{
  "detail": "请求格式错误",
  "errors": {
    "fingerprints": ["此字段是必需的。"]
  }
}
```
### 3.系统日志搜索接口
GET /api/logs/search/
#### 请求参数
| 参数名 | 类型 | 说明 | 必填 |
| user_id | integer | 用户ID过滤 | 否 |
| action | string | 操作类型过滤 | 否 |
| status | string | 状态过滤 (success/failed) | 否 |
| start_date | date | 起始日期，格式：YYYY-MM-DD | 否 |
| end_date | date | 结束日期，格式：YYYY-MM-DD | 否 |
| message | string | 消息内容模糊搜索 | 否 |
| page | integer | 页码，默认为1 | 否 |
| page_size | integer | 每页数量，默认为10 | 否 |
#### 响应
{
  "count": 20,
  "next": "http://localhost:8000/api/logs/search/?page=2&user_id=1&action=create_task",
  "previous": null,
  "results": [
    {
      "id": 1,
      "user": {
        "id": 1,
        "username": "admin"
      },
      "action": "create_task",
      "action_display": "创建任务",
      "target_id": 1,
      "status": "success",
      "status_display": "成功",
      "message": "创建爬虫任务: https://example.com (简单模式)",
      "created_at": "2023-11-09T12:00:00Z"
    },
    // ... 更多日志记录
  ]
}